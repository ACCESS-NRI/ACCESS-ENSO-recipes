# ESMValTool
# 
---
documentation:
  description: Reproducing ENSO feedback metrics by Yann Planton
  title: ENSO CLIVAR metrics - ENSO feedback
  authors:
    - chun_felicity
    # - sullivan_arnold
    # - gillet_zoe
  maintainer:
    - chun_felicity

# datasets: &model_datasets
#   - {dataset: ACCESS-ESM1-5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: ACCESS-CM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: BCC-CSM2-MR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CAS-ESM2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CESM2-FV2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CESM2-WACCM-FV2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CESM2-WACCM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CESM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CMCC-CM2-HR4, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CMCC-CM2-SR5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CMCC-ESM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: CanESM5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: FGOALS-g3, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: FIO-ESM-2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: GISS-E2-1-H, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MCM-UA-1-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MIROC6, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MPI-ESM-1-2-HAM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MPI-ESM1-2-HR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MPI-ESM1-2-LR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: MRI-ESM2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: NorCPM1, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: NorESM2-LM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: NorESM2-MM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: SAM0-UNICON, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: TaiESM1, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}

  # observations
  # - {dataset: HadISST, project: OBS, type: reanaly, tier: 2, mip: Omon}
  
  
preprocessors:
  base_east: &base #20sst, 21ssh
    custom_order: true # turned off degC is last - looks wrong
    convert_units:
      units: degC
    mask_landsea:
      mask_out: land
    anomalies:
      period: monthly
    detrend:
      dimension: time
      method: linear
    regrid:
      target_grid: 1x1 
      scheme: linear
    extract_region: &east
      start_longitude: 210.
      end_longitude: 270.
      start_latitude: -5.
      end_latitude: 5.
    area_statistics:
      operator: mean

  taux_eqp: &eqp_lv3
    convert_units:
      units: 1e-3 N/m2
    mask_landsea:
      mask_out: land
    anomalies:
      period: monthly
    detrend:
      dimension: time
      method: linear
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_region: &eqp
      start_longitude: 150.
      end_longitude: 270.
      start_latitude: -5.
      end_latitude: 5.
    meridional_statistics:
      operator: mean
  
  ssh_eqp_area:
    <<: *base
    custom_order: false
    convert_units:
      units: cm
    extract_region: #eqp
      <<: *eqp

  sst_eqp_merid: #lvl3
    <<: *eqp_lv3
    convert_units:
      units: degC
  hf_east:
    <<: *base
    convert_units:
      units: W m-2

diagnostics:
  
  nhf_metrics:
    description: run for SST NHF metrics
    variables:
      sst_east:
        short_name: ts
        mip: Amon
        preprocessor: base_east
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS6, type: reanaly, tier: 3, version: 1, start_year: 1979, end_year: 2014}

      nhf_east_mod: 
        short_name: hfns
        mip: Amon
        derive: true # hfls+hfss ..#need to make negative for hfds
        preprocessor: hf_east #obs separate? hfds not derive
        additional_datasets: 
          - {dataset: ACCESS-ESM1-5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
        
      nhf_east_obs:
        short_name: hfds
        mip: Omon
        preprocessor: hf_east
        additional_datasets:
          - {dataset: TROPFLUX, project: OBS6, type: reanaly, tier: 2, version: 1, start_year: 1979, end_year: 2014}
    
 
    scripts:
      plot_script:
        script: /home/189/fc6164/esmValTool/repos/ENSO_recipes/recipe_diagnostics/diagnostic_scripts/feedback_metrics.py


